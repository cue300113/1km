# Whitelabel Error Page 问题排查指南

## 1. 检查后端服务状态

### 检查Java进程
```bash
ps aux | grep java
# 应该看到类似：java -jar your-app.jar
```

### 检查端口占用
```bash
netstat -tlnp | grep 8081
# 应该看到：tcp 0 0 0.0.0.0:8081 0.0.0.0:* LISTEN
```

### 检查服务日志
```bash
# 查看应用日志
tail -f /var/log/your-app/application.log

# 或者查看jar包运行日志
tail -f nohup.out
```

## 2. 测试API接口

### 直接测试后端API
```bash
# 测试健康检查接口（如果有的话）
curl -v http://localhost:8081/api/health

# 测试发送验证码接口
curl -X POST http://localhost:8081/api/send-verification-code \
  -H "Content-Type: application/json" \
  -d '{"email":"test@example.com"}'
```

### 通过Nginx测试
```bash
# 测试通过Nginx代理的API
curl -X POST https://1kmchat.xin/api/send-verification-code \
  -H "Content-Type: application/json" \
  -d '{"email":"test@example.com"}'
```

## 3. 检查Nginx配置

### 测试Nginx配置
```bash
# 检查Nginx配置语法
sudo nginx -t

# 重新加载Nginx配置
sudo nginx -s reload
```

### 查看Nginx错误日志
```bash
# 查看Nginx错误日志
sudo tail -f /var/log/nginx/error.log

# 查看Nginx访问日志
sudo tail -f /var/log/nginx/access.log
```

## 4. 检查防火墙和端口

### 检查防火墙状态
```bash
# Ubuntu/Debian
sudo ufw status

# CentOS/RHEL
sudo firewall-cmd --list-ports
```

### 开放必要端口
```bash
# Ubuntu/Debian
sudo ufw allow 8081
sudo ufw allow 443
sudo ufw allow 80

# CentOS/RHEL
sudo firewall-cmd --permanent --add-port=8081/tcp
sudo firewall-cmd --permanent --add-port=443/tcp
sudo firewall-cmd --permanent --add-port=80/tcp
sudo firewall-cmd --reload
```

## 5. 检查SSL证书

### 验证SSL证书
```bash
# 检查SSL证书是否有效
openssl x509 -in /etc/nginx/cert/1kmchat.xin.pem -text -noout

# 测试SSL连接
openssl s_client -connect 1kmchat.xin:443 -servername 1kmchat.xin
```

## 6. 常见问题解决

### 问题1：后端服务无法启动
```bash
# 检查Java版本
java -version

# 检查jar包权限
ls -la your-app.jar

# 手动启动查看错误
java -jar your-app.jar --spring.profiles.active=prod
```

### 问题2：数据库连接问题
```bash
# 检查数据库服务
sudo systemctl status mysql
# 或
sudo systemctl status postgresql

# 测试数据库连接
mysql -u username -p -h localhost
```

### 问题3：内存不足
```bash
# 检查内存使用
free -h

# 检查Java进程内存使用
jstat -gc <pid>
```

## 7. 调试模式启动

### 启动Spring Boot应用（调试模式）
```bash
# 设置调试日志级别
java -jar your-app.jar \
  --spring.profiles.active=prod \
  --logging.level.root=DEBUG \
  --logging.level.com.yourpackage=DEBUG
```

### 查看详细错误信息
```bash
# 查看系统日志
sudo journalctl -u your-service-name -f

# 查看内核日志
sudo dmesg | tail -20
```

## 8. 网络连接测试

### 测试内网连接
```bash
# 从Nginx服务器测试后端连接
curl -v http://101.201.52.163:8081/api/health

# 测试DNS解析
nslookup 1kmchat.xin
```

### 测试外网访问
```bash
# 从外部测试
curl -v https://1kmchat.xin/api/health
```

## 9. 应急解决方案

### 临时绕过Nginx直接访问后端
```bash
# 临时开放后端端口到外网（仅用于测试）
# 在安全组中开放8081端口
# 然后直接访问：http://101.201.52.163:8081/api/health
```

### 使用systemd管理服务
```bash
# 创建服务文件
sudo vim /etc/systemd/system/1kmchat.service

# 服务文件内容
[Unit]
Description=1kmchat Spring Boot App
After=network.target

[Service]
Type=simple
User=your-user
ExecStart=/usr/bin/java -jar /path/to/your-app.jar
Restart=always
RestartSec=10
Environment=SPRING_PROFILES_ACTIVE=prod

[Install]
WantedBy=multi-user.target

# 启用并启动服务
sudo systemctl enable 1kmchat
sudo systemctl start 1kmchat
sudo systemctl status 1kmchat
```

